Ранее использовалась аутентификация с помощью [[Java/Storing info/Session|Session]] и [[Cookies]]. В большинстве случаев аутентификация с помощью сессий и кукис - предпочтительный вариант, но иогда требуется другой подход. Когда ? В микросервисной архитектуре

![[microservice problem.png]]

* На **КАЖДОМ** сервисе приходится хранить сессию для пользователя (дублирование данных)
* Если меняем данные в сессии пользователя в одном из сервисов, приходится растропранять эти изменениея на все остальные сервисы
* Могут быть проблемы с консистентностью данных (данные в сессии пользователя различаются в разных сервисах)

 Эту проблему можно попробовать решить созданием отдельного сервера, который будет хранить данные сессий, но проблема в том, что если сервер упадёт, то пользователь потеряет доступ ко всем сервисам

## JWT
Json Web Token

![[JWT.png]]

![[JWT how to work.png]]
![[JWT structure.png]]

### JWT vs Sessions + Cookies

* Stateless vs Stateful
* JWT - "все свои данные ношу с собой". Если в сессии пользователя много информаии её придётся передавать при каждом запросе --> нагрузка на сеть и более долгие запросы. В свою очередь, Cookies - всегда лишь одна пара ключ-значение --> более быстрые запросы
* Пользователь не знает, что мы хрнаим о нём/ней в нашей сессии, а в JWT токене пользователь может посмотреть всё, что мы храним о нём
* В сессиях мы можем менять данные пользователя у себя на сервере когда захотим. Менять данные в его JWT токене мы не можем (токен неизменный и находится на компьютере пользователя), можем только выдать ему новый, когда он попросит (когда истечет срок годности нового токена)
* У механизма сессии + cookies больше преимуществ, поэтом JWT используется только тогда, когда он действительно оправдан(например в микросервисной архитектуре)
* Токен нельзя никому передавать. Если другой человек завладеет вашим токеном, он сможет делать запросы к серверу от вашего лица. Передать токен - то же самое, что передать пароль
* Однако, утерять токен все-таки менее страшно, чем утерять пароль. Токен имеет ограниченный срок действия
* Мы не можем сами поменять свой JWT токен и изменить данные в своей "сессии", так как у нас нет *секрета*. Сервер проверяет подпись токена на корректность при каждом запросе